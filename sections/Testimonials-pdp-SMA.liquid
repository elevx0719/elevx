<style>
  .testimonials-section {
    padding: 60px 0;
    overflow: hidden;
  }
  
  .testimonials-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }
  
  .testimonials-header {
    text-align: center;
    margin-bottom: 50px;
  }
  
  .testimonials-title {
    font-size: 2.5rem;
    font-weight: bold;
    color: {{ section.settings.heading_color }};
    margin-bottom: 15px;
    font-family: inherit;
  }
  
  .testimonials-subtitle {
    font-size: 1.1rem;
    color: {{ section.settings.text_color }};
    opacity: 0.8;
    font-family: inherit;
  }
  
  .carousel-container {
    position: relative;
    overflow: hidden;
    margin-bottom: 30px;
  }
  
  .carousel-wrapper {
    display: flex;
    transition: transform 0.5s ease;
    will-change: transform;
  }
  
  .testimonial-slide {
    flex: 0 0 100%;
    padding: 0 10px;
    box-sizing: border-box;
  }
  
  .testimonial-card {
    border-radius: 15px;
    padding: 40px 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    text-align: center;
    height: 100%;
    box-sizing: border-box;
  }
  
  .testimonial-image {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    margin: 0 auto 20px;
    border: 1px solid {{ section.settings.accent_color }};
    display: block;
  }
  
  .testimonial-stars {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
    gap: 3px;
  }
  
  .star {
    color: #ffc107;
    font-size: 20px;
    line-height: 1;
  }
  
  .star.empty {
    color: #e4e5e9;
  }
  
  .testimonial-quote {
    font-size: 1.1rem;
    line-height: 1.6;
    color: #333;
    margin-bottom: 25px;
    font-style: italic;
    font-family: inherit;
  }
  
  .testimonial-author {
    font-weight: bold;
    color: {{ section.settings.heading_color }};
    margin-bottom: 5px;
    font-size: 1.1rem;
    font-family: inherit;
  }
  
  .testimonial-designation {
    color: {{ section.settings.accent_color }};
    font-size: 0.9rem;
    font-family: inherit;
  }
  
  .carousel-nav {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 30px;
  }
  
  .carousel-btn {
    width: 50px;
    height: 50px;
    border: none;
    border-radius: 50%;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: bold;
    color: {{ section.settings.accent_color }};
    transition: all 0.3s ease;
  }
  
  .carousel-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }
  
  .carousel-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .carousel-dots {
    display: flex;
    justify-content: center;
    gap: 8px;
  }
  
  .carousel-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: none;
    background-color: {{ section.settings.accent_color }};
    opacity: 0.3;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }
  
  .carousel-dot.active {
    opacity: 1;
  }
  
  /* Desktop styles */
  @media (min-width: 1024px) {
    .testimonial-slide {
      flex: 0 0 {{ 100 | divided_by: section.settings.slides_desktop }}%;
    }
  }
  
  /* Tablet styles */
  @media (min-width: 768px) and (max-width: 1023px) {
    .testimonial-slide {
      flex: 0 0 50%;
    }
  }
  
  @media (max-width: 768px) {
    .testimonials-title {
      font-size: 2rem;
    }
    
    .testimonial-card {
      padding: 30px 20px;
    }
    
    .testimonial-image {
      width: 80px;
      height: 80px;
    }
    
    .carousel-btn {
      width: 40px;
      height: 40px;
      font-size: 16px;
    }
  }
  
  @media (max-width: 480px) {
    .carousel-nav {
      flex-direction: column;
      gap: 15px;
    }
  }
</style>

<section class="testimonials-section">
  <div class="testimonials-container">
    {% if section.settings.heading != blank %}
      <div class="testimonials-header">
        <h2 class="testimonials-title">{{ section.settings.heading }}</h2>
        {% if section.settings.subheading != blank %}
          <p class="testimonials-subtitle">{{ section.settings.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}
    
    <div class="carousel-container" id="testimonials-carousel">
      <div class="carousel-wrapper" id="carousel-wrapper">
        {% for block in section.blocks %}
          <div class="testimonial-slide">
            <div class="testimonial-card">
              {% if block.settings.image != blank %}
                <img src="{{ block.settings.image | img_url: '200x200' }}" 
                     alt="{{ block.settings.name }}" 
                     class="testimonial-image">
              {% endif %}
              
              {% if block.settings.rating > 0 %}
                <div class="testimonial-stars">
                  {% for i in (1..5) %}
                    {% if i <= block.settings.rating %}
                      <span class="star">★</span>
                    {% else %}
                      <span class="star empty">★</span>
                    {% endif %}
                  {% endfor %}
                </div>
              {% endif %}
              
              {% if block.settings.quote != blank %}
                <div class="testimonial-quote">
                  "{{ block.settings.quote }}"
                </div>
              {% endif %}
              
              {% if block.settings.name != blank %}
                <div class="testimonial-author">{{ block.settings.name }}</div>
              {% endif %}
              
              {% if block.settings.designation != blank %}
                <div class="testimonial-designation">{{ block.settings.designation }}</div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    
    {% if section.blocks.size > 1 %}
      <div class="carousel-nav">
        <div class="carousel-dots" id="carousel-dots">
          {% for block in section.blocks %}
            <button class="carousel-dot{% if forloop.first %} active{% endif %}" data-slide="{{ forloop.index0 }}"></button>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </div>
</section>

<script>
(function() {
  const carousel = document.getElementById('testimonials-carousel');
  const wrapper = document.getElementById('carousel-wrapper');
  const dots = document.querySelectorAll('.carousel-dot');
  
  if (!carousel || !wrapper) return;
  
  let currentSlide = 0;
  const totalSlides = {{ section.blocks.size }};
  const autoplayDelay = {{ section.settings.autoplay_delay | default: 5000 }};
  let autoplayInterval;
  
  // Get slides per view based on screen size
  function getSlidesPerView() {
    if (window.innerWidth >= 1024) {
      return {{ section.settings.slides_desktop | default: 3 }};
    } else if (window.innerWidth >= 768) {
      return 2;
    } else {
      return 1;
    }
  }
  
  // Calculate max slide index
  function getMaxSlide() {
    const slidesPerView = getSlidesPerView();
    return Math.max(0, totalSlides - slidesPerView);
  }
  
  // Update carousel position
  function updateCarousel() {
    const slidesPerView = getSlidesPerView();
    const slideWidth = 100 / slidesPerView;
    const translateX = -(currentSlide * slideWidth);
    wrapper.style.transform = `translateX(${translateX}%)`;
    
    // Update dots
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentSlide);
    });
  }
  
  // Go to specific slide
  function goToSlide(slideIndex) {
    const maxSlide = getMaxSlide();
    currentSlide = Math.max(0, Math.min(slideIndex, maxSlide));
    updateCarousel();
  }
  
  // Next slide
  function nextSlide() {
    if (currentSlide < getMaxSlide()) {
      currentSlide++;
    } else {
      currentSlide = 0; // Loop back to start
    }
    updateCarousel();
  }
  
  // Previous slide
  function prevSlide() {
    if (currentSlide > 0) {
      currentSlide--;
    } else {
      currentSlide = getMaxSlide(); // Loop to end
    }
    updateCarousel();
  }
  
  // Start autoplay
  function startAutoplay() {
    if (totalSlides > getSlidesPerView()) {
      autoplayInterval = setInterval(nextSlide, autoplayDelay);
    }
  }
  
  // Stop autoplay
  function stopAutoplay() {
    if (autoplayInterval) {
      clearInterval(autoplayInterval);
      autoplayInterval = null;
    }
  }
  
  // Event listeners
  // Dot navigation
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      goToSlide(index);
      stopAutoplay();
      setTimeout(startAutoplay, 2000); // Restart autoplay after 2 seconds
    });
  });
  
  // Touch/swipe support
  let startX = 0;
  let isDragging = false;
  
  carousel.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
    isDragging = true;
    stopAutoplay();
  });
  
  carousel.addEventListener('touchend', (e) => {
    if (!isDragging) return;
    
    const endX = e.changedTouches[0].clientX;
    const diffX = startX - endX;
    
    if (Math.abs(diffX) > 50) { // Minimum swipe distance
      if (diffX > 0) {
        nextSlide();
      } else {
        prevSlide();
      }
    }
    
    isDragging = false;
    setTimeout(startAutoplay, 2000);
  });
  
  // Pause autoplay on hover
  carousel.addEventListener('mouseenter', stopAutoplay);
  carousel.addEventListener('mouseleave', startAutoplay);
  
  // Handle window resize
  window.addEventListener('resize', () => {
    currentSlide = Math.min(currentSlide, getMaxSlide());
    updateCarousel();
  });
  
  // Initialize
  setTimeout(() => {
    updateCarousel();
    startAutoplay();
  }, 100);
})();
</script>

{% schema %}
{
  "name": "Testimonials Carousel",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What Our Customers Say"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Don't just take our word for it - hear from our satisfied customers"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f8f9fa"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#007bff"
    },
    {
      "type": "range",
      "id": "slides_desktop",
      "label": "Slides per view (Desktop)",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "autoplay_delay",
      "label": "Autoplay Delay (milliseconds)",
      "min": 2000,
      "max": 5000,
      "step": 500,
      "default": 5000
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Customer Photo"
        },
        {
          "type": "range",
          "id": "rating",
          "label": "Star Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "textarea",
          "id": "quote",
          "label": "Testimonial Quote",
          "default": "This product exceeded my expectations! The quality is outstanding and the customer service was fantastic."
        },
        {
          "type": "text",
          "id": "name",
          "label": "Customer Name",
          "default": "John Smith"
        },
        {
          "type": "text",
          "id": "designation",
          "label": "Customer Designation",
          "default": "CEO, Company Name"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials Carousel",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "rating": 5,
            "quote": "This product exceeded my expectations! The quality is outstanding and the customer service was fantastic.",
            "name": "Sarah Johnson",
            "designation": "Marketing Director, Tech Corp"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "rating": 5,
            "quote": "I've been using this for months now and couldn't be happier. Highly recommended!",
            "name": "Mike Chen",
            "designation": "Small Business Owner"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "rating": 4,
            "quote": "Great value for money and excellent customer support. Will definitely purchase again.",
            "name": "Emily Davis",
            "designation": "Freelance Designer"
          }
        }
      ]
    }
  ]
}
{% endschema %}